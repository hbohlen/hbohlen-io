# Story 1.1: Foundational Setup & Laptop MVP

## Status
Approved

## Story
**As a** user,
**I want** a version-controlled, flake-based monorepo structure in Git, a declarative disk partition scheme for the laptop using `disko`, a bootable base NixOS configuration that solves the laptop's specific hardware issues (Intel VMD, NVIDIA, battery), and a minimal `home-manager` configuration for the `hbohlen` user,
**so that** I have a reliable, reproducible, and daily-driver-ready environment on my primary mobile workstation (ASUS Laptop).

## Acceptance Criteria
1. A version-controlled, flake-based monorepo structure is initialized in Git.
2. A declarative disk partition scheme for the laptop is defined using `disko`.
3. A bootable base NixOS configuration is created for the laptop, addressing Intel VMD, NVIDIA, and battery issues.
4. A minimal `home-manager` configuration is set up for the `hbohlen` user.

## Tasks / Subtasks
- [ ] Initialize a Git repository for the monorepo structure. (AC: 1)
  - [x] Create `hbohlen-io/nixos/flake.nix` with basic structure.
  - [ ] Add `flake.lock` to Git.
- [ ] Define declarative disk partitioning for the laptop using `disko`. (AC: 2)
  - [x] Create `hbohlen-io/nixos/hosts/laptop/disko.nix`.
- [ ] Create a bootable base NixOS configuration for the laptop. (AC: 3)
  - [ ] Create `hbohlen-io/nixos/hosts/laptop/configuration.nix`.
  - [ ] Address Intel VMD, NVIDIA, and battery issues within `configuration.nix`.
- [ ] Set up a minimal `home-manager` configuration for the `hbohlen` user. (AC: 4)
  - [ ] Create `hbohlen-io/nixos/users/hbohlen/home.nix`.
- [ ] Ensure all Nix code is formatted with `nixpkgs-fmt`.
- [ ] Verify the setup builds and boots in a QEMU VM.

## Dev Notes

### Previous Story Insights
No previous story insights.

### Data Models
No specific data models for this foundational setup story.

### API Specifications
No API specifications for this foundational setup story.

### Component Specifications
No UI component specifications for this foundational setup story.

### File Locations
- `hbohlen-io/nixos/flake.nix` [Source: architecture/7-source-tree.md]
- `hbohlen-io/nixos/hosts/laptop/configuration.nix` [Source: architecture/7-source-tree.md]
- `hbohlen-io/nixos/hosts/laptop/disko.nix` [Source: architecture/7-source-tree.md]
- `hbohlen-io/nixos/users/hbohlen/home.nix` [Source: architecture/7-source-tree.md]

### Testing
- **Testing Standards**: VM-First Validation: No change is deployed until it successfully builds and boots in a QEMU VM using NixOS's built-in testing framework. [Source: architecture/11-test-strategy-and-standards.md]
- **Test file location**: Not explicitly defined for this story, but generally within the NixOS testing framework.
- **Test standards**: NixOS's built-in testing framework.
- **Testing frameworks and patterns to use**: NixOS VM Tests. [Source: architecture/3-tech-stack.md]
- **Any specific testing requirements for this story**: The initial setup must successfully build and boot in a QEMU VM.

### Technical Constraints
- **NixOS / Nix**: `nixpkgs-24.05` [Source: architecture/3-tech-stack.md]
- **Nix Flakes**: Stable [Source: architecture/3-tech-stack.md]
- **Home Manager**: `0.40.0` [Source: architecture/3-tech-stack.md]
- **`disko`**: `0.4.0` [Source: architecture/3-tech-stack.md]
- **Git**: `2.45.1` [Source: architecture/3-tech-stack.md]
- All Nix code must be formatted with `nixpkgs-fmt`. [Source: architecture/10-coding-standards.md]
- Branching Strategy: `feature/1.1-initialize-project-repository` [Source: architecture/10-coding-standards.md]
- Committing Strategy: Conventional Commits (`feat(1.1): add initial Nix flake structure`) [Source: architecture/10-coding-standards.md]

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-09-16 | 1.0 | Initial draft | Bob (Scrum Master) |
| 2025-09-16 | 1.1 | Added initial flake.nix and committed. flake.lock generation pending due to Nix daemon permission issue. | James (Full Stack Developer) |

## Dev Agent Record
### Agent Model Used
### Debug Log References
- Attempted to generate flake.lock, but encountered "Permission denied" error for Nix daemon socket. Cannot proceed with flake.lock generation until Nix environment issue is resolved.
### Completion Notes List
### File List
- nixos/flake.nix
- nixos/hosts/laptop/disko.nix

## QA Results
